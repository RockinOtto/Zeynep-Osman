{% extends "layout.html" %}

{% block content %}
<header>
    <h1>Zeynep <span class="heart">‚ù§Ô∏è</span> Osman</h1>
    <p class="subtitle">Bir sonraki bulu≈ümamƒ±z...</p>
</header>

<!-- Konfeti Container -->
<div id="confettiContainer"></div>

<section class="meeting-section box-glass">
    <h2>üíï Bulu≈üma Takvimimiz</h2>

    <!-- Geri Sayƒ±m - Sadece G√ºn -->
    <div class="meeting-countdown" id="meetingCountdown">
        <div class="countdown-item big-countdown">
            <span id="meetingDays">0</span>
            <span class="label">G√ºn Kaldƒ±</span>
        </div>
    </div>
    <p class="meeting-message" id="meetingMessage">Bulu≈ümaya kalan s√ºre</p>

    <!-- Takvim -->
    <div class="calendar-container">
        <div class="calendar-header">
            <button class="calendar-nav" id="prevMonth">‚óÄ</button>
            <h3 id="calendarTitle">≈ûubat 2026</h3>
            <button class="calendar-nav" id="nextMonth">‚ñ∂</button>
        </div>
        <div class="calendar-weekdays">
            <span>Pzt</span>
            <span>Sal</span>
            <span>√áar</span>
            <span>Per</span>
            <span>Cum</span>
            <span>Cmt</span>
            <span>Paz</span>
        </div>
        <div class="calendar-days" id="calendarDays">
            <!-- JavaScript ile doldurulacak -->
        </div>
    </div>

    <!-- Bulu≈üma Tarihi Ayarlama -->
    <div class="meeting-date-picker">
        <label for="meetingDate">Bulu≈üma Tarihimiz:</label>
        <input type="date" id="meetingDate" name="meetingDate">
        <button class="save-meeting-btn" id="saveMeetingDate">üíù Kaydet</button>
    </div>
</section>

<style>
    /* B√ºy√ºk geri sayƒ±m */
    .big-countdown {
        padding: 2rem 3rem !important;
        min-width: 150px !important;
    }

    .big-countdown span:first-child {
        font-size: 4rem !important;
    }

    .big-countdown .label {
        font-size: 1rem !important;
    }

    /* Konfeti */
    #confettiContainer {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9999;
        overflow: hidden;
    }

    .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        opacity: 0;
        animation: confettiFall 4s ease-out forwards;
    }

    @keyframes confettiFall {
        0% {
            opacity: 1;
            transform: translateY(-100px) rotate(0deg);
        }

        100% {
            opacity: 0;
            transform: translateY(100vh) rotate(720deg);
        }
    }

    /* Bulu≈üma g√ºn√º √∂zel mesaj */
    .meeting-today {
        font-size: 1.5rem !important;
        color: var(--primary-color);
        animation: bounce 1s infinite;
    }

    @keyframes bounce {

        0%,
        100% {
            transform: scale(1);
        }

        50% {
            transform: scale(1.1);
        }
    }
</style>

<script>
    // Bulu≈üma tarihi (localStorage'dan al veya varsayƒ±lan)
    let meetingDate = localStorage.getItem('meetingDate') || '';
    let confettiTriggered = false;

    const monthNames = ['Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran',
        'Temmuz', 'Aƒüustos', 'Eyl√ºl', 'Ekim', 'Kasƒ±m', 'Aralƒ±k'];

    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();

    // Konfeti olu≈ütur
    function createConfetti() {
        const container = document.getElementById('confettiContainer');
        const colors = ['#ff4d6d', '#ff8fa3', '#ffccd5', '#fff0f3', '#ffd700', '#ff69b4', '#ff1493'];
        const shapes = ['‚ù§Ô∏è', 'üíï', 'üíñ', '‚ú®', 'üéâ', 'üíó'];

        for (let i = 0; i < 100; i++) {
            setTimeout(() => {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = (3 + Math.random() * 2) + 's';

                // Rastgele ≈üekil veya renk
                if (Math.random() > 0.5) {
                    confetti.textContent = shapes[Math.floor(Math.random() * shapes.length)];
                    confetti.style.fontSize = (15 + Math.random() * 20) + 'px';
                } else {
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.width = (8 + Math.random() * 10) + 'px';
                    confetti.style.height = (8 + Math.random() * 10) + 'px';
                }

                container.appendChild(confetti);

                // Temizle
                setTimeout(() => confetti.remove(), 5000);
            }, i * 30);
        }
    }

    // Takvimi render et
    function renderCalendar() {
        const calendarDays = document.getElementById('calendarDays');
        const calendarTitle = document.getElementById('calendarTitle');

        calendarTitle.textContent = `${monthNames[currentMonth]} ${currentYear}`;

        // Ayƒ±n ilk g√ºn√º ve toplam g√ºn sayƒ±sƒ±
        const firstDay = new Date(currentYear, currentMonth, 1).getDay();
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

        // Pazartesi'den ba≈ülat (0=Paz, 1=Pzt -> 0=Pzt olacak ≈üekilde ayarla)
        const startDay = firstDay === 0 ? 6 : firstDay - 1;

        let html = '';

        // Bo≈ü g√ºnler
        for (let i = 0; i < startDay; i++) {
            html += '<span class="calendar-day empty"></span>';
        }

        // G√ºnler
        const today = new Date();
        for (let day = 1; day <= daysInMonth; day++) {
            const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const isToday = (day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear());
            const isMeeting = (dateStr === meetingDate);

            let classes = 'calendar-day';
            if (isToday) classes += ' today';
            if (isMeeting) classes += ' meeting-day';

            html += `<span class="${classes}" data-date="${dateStr}">${day}${isMeeting ? ' ‚ù§Ô∏è' : ''}</span>`;
        }

        calendarDays.innerHTML = html;
    }

    // Geri sayƒ±mƒ± g√ºncelle
    function updateMeetingCountdown() {
        const messageEl = document.getElementById('meetingMessage');
        const daysEl = document.getElementById('meetingDays');

        if (!meetingDate) {
            messageEl.textContent = 'Hen√ºz bulu≈üma tarihi belirlenmedi üí≠';
            messageEl.className = 'meeting-message';
            daysEl.textContent = '?';
            return;
        }

        const now = new Date();
        now.setHours(0, 0, 0, 0);
        const meeting = new Date(meetingDate + 'T00:00:00');
        const diff = meeting - now;
        const days = Math.ceil(diff / (1000 * 60 * 60 * 24));

        const meetingDateObj = new Date(meetingDate);
        const dayName = ['Pazar', 'Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi'][meetingDateObj.getDay()];
        const monthName = monthNames[meetingDateObj.getMonth()];

        if (days <= 0) {
            // Bulu≈üma g√ºn√º geldi!
            daysEl.textContent = 'üéâ';
            messageEl.innerHTML = 'üíï BULU≈ûMA G√úN√ú GELDƒ∞! üíï';
            messageEl.className = 'meeting-message meeting-today';

            // Konfeti animasyonu (sadece bir kez)
            if (!confettiTriggered) {
                confettiTriggered = true;
                createConfetti();
                // Her 5 saniyede konfeti
                setInterval(createConfetti, 8000);
            }
        } else if (days === 1) {
            daysEl.textContent = '1';
            messageEl.textContent = `Yarƒ±n bulu≈üuyoruz! ü•∞ (${meetingDateObj.getDate()} ${monthName} ${dayName})`;
            messageEl.className = 'meeting-message';
        } else {
            daysEl.textContent = days;
            messageEl.textContent = `${meetingDateObj.getDate()} ${monthName} ${dayName} g√ºn√º bulu≈üuyoruz! üíï`;
            messageEl.className = 'meeting-message';
        }
    }

    // Tarihi kaydet
    document.getElementById('saveMeetingDate').addEventListener('click', function () {
        const dateInput = document.getElementById('meetingDate').value;
        if (dateInput) {
            meetingDate = dateInput;
            confettiTriggered = false; // Reset confetti
            localStorage.setItem('meetingDate', meetingDate);
            renderCalendar();
            updateMeetingCountdown();
            alert('Bulu≈üma tarihi kaydedildi! üíï');
        }
    });

    // √ñnceki/Sonraki ay
    document.getElementById('prevMonth').addEventListener('click', function () {
        currentMonth--;
        if (currentMonth < 0) {
            currentMonth = 11;
            currentYear--;
        }
        renderCalendar();
    });

    document.getElementById('nextMonth').addEventListener('click', function () {
        currentMonth++;
        if (currentMonth > 11) {
            currentMonth = 0;
            currentYear++;
        }
        renderCalendar();
    });

    // Ba≈ülat
    if (meetingDate) {
        document.getElementById('meetingDate').value = meetingDate;
    }
    renderCalendar();
    updateMeetingCountdown();
    setInterval(updateMeetingCountdown, 60000); // Her dakika g√ºncelle
</script>
{% endblock %}